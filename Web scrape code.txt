import csv
import time
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# ‚úÖ Path to your local ChromeDriver
service = Service('C:\\Users\\chromedriver-win64\\chromedriver.exe')
driver = webdriver.Chrome(service=service)

# ‚úÖ Open the Physician Jobs page
driver.get('https://www.doccafe.com/physician-jobs')
driver.maximize_window()
wait = WebDriverWait(driver, 20)

# ‚úÖ Click the Specialty dropdown
try:
    dropdown = wait.until(EC.element_to_be_clickable((By.XPATH, "//div[contains(text(),'Specialty')]")))
    dropdown.click()
    print("‚úÖ Clicked Specialty dropdown.")
except Exception as e:
    print("‚ùå Failed to click dropdown:", e)
    driver.quit()
    exit()

# ‚úÖ Wait for dropdown options to load
time.sleep(4)

# ‚úÖ Extract specialty options
try:
    options = driver.find_elements(By.XPATH, "//div[@role='listbox']//div[@role='option']")
    print(f"‚úÖ Found {len(options)} specialty options.")

    if not options:
        print("‚ùå No options found. Possible DOM issue.")

    specialties = [opt.text.strip() for opt in options if opt.text.strip()]

    # ‚úÖ Print and save to CSV
    print("ü©∫ Extracted Specialties:")
    for idx, spec in enumerate(specialties, 1):
        print(f"{idx}. {spec}")

    with open('physician_specialties.csv', 'w', newline='', encoding='utf-8') as f:
        writer = csv.writer(f)
        writer.writerow(['Specialty'])
        for spec in specialties:
            writer.writerow([spec])

    print("\n‚úÖ Saved to 'physician_specialties.csv'")

except Exception as e:
    print("‚ùå Could not extract specialty options. Error:", e)

driver.quit()
